---
title: "Project Title TBD"
author: "Andrew Olson"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    orientation: row
    vertical_layout: fill
    theme: cosmo
    favicon: favicon.ico
---

```{r setup, include=FALSE}
#loading libraries used
library(flexdashboard)
library(shiny)
library(reshape2)
library(dplyr)
library(plotly)

#loading data to be used
jail.dirty <- read.csv(file="August_Jail_Census.csv", header = TRUE, sep = ",", na.strings = "")

pdf(NULL)

#recoding race and gender to be more descriptive
jail.load <- jail.dirty %>% mutate(Race = recode(Race, "B" = "Black",
                                  "A" = "Asian",
                                  "H" = "Hispanic",
                                  "W" = "White",
                                  "I" = "American Indian",
                                  "U" = "Unknown",
                                  "x" = NULL),
                    Gender = recode(Gender, "M" = "Male", "F" = "Female"),
                    Date = as.Date(Date),
                    X_id = as.factor(X_id))

jaInput <- reactive({
  # Age Filter
  jail <- jail.load %>%
    filter(Current.Age >= input$AgeSelect[1] & Current.Age <= input$AgeSelect[2])
  #Date Filter
  jail2 <- jail %>%
    filter(Date >= input$DateSelect[1] & Date <= input$DateSelect[2])
  # Booking Age Filter
  jail3 <- jail2 %>% 
    filter(Age.at.Booking >= input$BookingAgeSelect[1] & Age.at.Booking <= input$BookingAgeSelect[2])
  # Race Filter
  if (length(input$RaceSelect) > 0 ) {
    jail3 <- subset(jail3, Race %in% input$RaceSelect)
  }
  
  return(jail3)
})

```

Sidebar {.sidebar}
=====================================

```{r}
#Race Selecter
selectInput("RaceSelect",
               "Race:",
               choices = sort(unique(jail.load$Race)),
               multiple = TRUE,
               selectize = TRUE,
               selected = c("Black", "White", "Hispanic"))
#Booking Age Selecter
sliderInput("BookingAgeSelect",
               "Age at Booking:",
               min = min(jail.load$Age.at.Booking, na.rm = T),
               max = max(jail.load$Age.at.Booking, na.rm = T),
               value = c(min(jail.load$Age.at.Booking, na.rm = T), max(jail.load$Age.at.Booking, na.rm = T)),
               step = 1)
#Current Age Selecter
sliderInput("AgeSelect",
               "Current Age:",
               min = min(jail.load$Current.Age, na.rm = T),
               max = max(jail.load$Current.Age, na.rm = T),
               value = c(min(jail.load$Current.Age, na.rm = T), max(jail.load$Current.Age, na.rm = T)),
               step = 1)
#Date Selecter
dateRangeInput("DateSelect",
               "Date range:",
               start = "8/6/2018",
               end = "8/21/2018",
               min = "8/6/2018",
               max = "8/31/2018",
               format = "mm/dd/yyyy")
```

Plot
=====================================

Row 
-------------------------------------

### 

```{r}
#Average Age at booking value box
renderValueBox({
  ja <- jaInput()
  num <- round(mean(ja$Age.at.Booking, na.rm = T), 0)
  valueBox("Avg Age at Booking", value = num, color = "purple")
})
```


### % Men in Jail

```{r}
#Guage of gender breakdown
renderGauge({
    ja <- jaInput()
  rate <- round((sum(ja$Gender == "Male")) / length(ja$Gender) * 100, 1)
  gauge(rate, min = 0, max = 100, symbol = '%', gaugeSectors(
  success = c(70, 100), warning = c(40, 69), danger = c(0, 30), colors = c("aqua", "green", "fuchsia")))
})
```

### 

```{r}
renderValueBox({
  ja <- jaInput()
  num <- round((sum(ja$Race == "White", na.rm = TRUE) / sum(ja$Race == "Black", na.rm = TRUE)), 2)
  valueBox("Ratio of White to Black Prisoners", value = num, color = "green")
})
```

Row {.tabset .tabset-fade}
-------------------------------------

### Graph 1

```{r}
#plot 1
#renderPlotly({
#    dat <- jaInput()
#    ggplot(data = dat, aes(x = Age.at.Booking, y = Race, fill = Race)) + 
#        geom_point()+
#        labs(x = "Age.at.Booking", y = "Race", title = "graph 1") +
#        guides(color = FALSE)
#  })
```

### Graph 2

```{r}
#plot 2
```

### Graph 3

```{r}
#plot 2
```

Table
=====================================

Row 
-------------------------------------

### Table 

```{r}

```
